<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8"><title>Rescate de B√≥veda</title>
    <style>
        body { background: #0d1117; color: #c9d1d9; font-family: 'Courier New', monospace; padding: 40px; }
        .box { border: 1px solid #30363d; padding: 20px; background: #161b22; border-radius: 8px; max-width: 600px; margin: auto; }
        input, button { width: 100%; margin: 10px 0; padding: 12px; background: #0d1117; color: #58a6ff; border: 1px solid #30363d; }
        button { background: #238636; color: white; cursor: pointer; font-weight: bold; }
        button:hover { background: #2ea043; }
        #resultado { margin-top: 20px; white-space: pre-wrap; color: #3fb950; display: none; }
    </style>
</head>
<body>
    <div class="box">
        <h2 style="color:#58a6ff;">üõ°Ô∏è Desencriptador Offline</h2>
        <p>1. Selecciona tu archivo <b>boveda_datos.enc</b></p>
        <input type="file" id="fileInput">
        <p>2. Ingresa tu Contrase√±a Maestra</p>
        <input type="password" id="passInput" placeholder="Contrase√±a de Cifrado">
        <button onclick="decrypt()">üîì DESBLOQUEAR B√ìVEDA</button>
        <div id="resultado"></div>
    </div>
    <script>
        async function decrypt() {
            const file = document.getElementById('fileInput').files[0];
            const password = document.getElementById('passInput').value;
            const out = document.getElementById('resultado');
            if (!file || !password) { alert("Falta archivo o contrase√±a."); return; }
            try {
                const arrayBuffer = await file.arrayBuffer();
                const data = new Uint8Array(arrayBuffer);
                const salt = data.slice(0, 16);
                const iv = data.slice(16, 28);
                const ciphertext = data.slice(28);
                
                const passKey = await crypto.subtle.importKey("raw", new TextEncoder().encode(password), {name: "PBKDF2"}, false, ["deriveKey"]);
                const aesKey = await crypto.subtle.deriveKey(
                    { name: "PBKDF2", salt: salt, iterations: 600000, hash: "SHA-256" },
                    passKey, { name: "AES-GCM", length: 256 }, false, ["decrypt"]
                );
                
                const decrypted = await crypto.subtle.decrypt({ name: "AES-GCM", iv: iv }, aesKey, ciphertext);
                const json = JSON.parse(new TextDecoder().decode(decrypted));
                
                let html = "<h3>‚úÖ DATOS RECUPERADOS:</h3>\n";
                json.forEach(item => { html += `üìå <b>${item.Plataforma}:</b> ${item.Credencial}\n`; });
                out.innerHTML = html; out.style.display = 'block';
            } catch (e) { alert("‚ùå Error: Contrase√±a incorrecta o archivo corrupto."); }
        }
    </script>
</body></html>